---
title: "Airbnb_8"
output: html_document
---

```{r load_packages, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)
library(mosaic)
library(ggfortify)
library(moderndive)
library(janitor)
library(huxtable)
library(here)
library(broom)
library(skimr)
library(GGally)
library(car)
library(vroom)
library(GGally)
```

price = cost per night

cleaning_fee: cleaning fee

extra_people: charge for having more than 1 person

property_type: type of accommodation (House, Apartment, etc.)

room_type:

Entire home/apt (guests have entire place to themselves)
Private room (Guests have private room to sleep, all other rooms shared)
Shared room (Guests sleep in room shared with others)
number_of_reviews: Total number of reviews for the listing

review_scores_rating: Average review score (0 - 100)

longitude , latitude: geographical coordinates to help us locate the listing

neighbourhood*: three variables on a few major neighbourhoods in each city

```{r cars}
listings <- vroom("http://data.insideairbnb.com/denmark/hovedstaden/copenhagen/2020-06-26/data/listings.csv.gz") %>% 
    #get the listings for Copenhagen
    clean_names()  
```



```{r, exploration, echo=FALSE}
# Looking at the raw values
glimpse(listings) 

#Computing summary statistics of the variables of interest, or finding NAs
skim(listings) 

```

#EDA

We tried first to convert some of the data from characters to numeric (i.e “$176.00”--. 176)

```{r Cleaning data,echo=FALSE}
# make price into a numeric variable
listings$price = as.numeric(gsub("[\\$,]", "", listings$price)) 

# make cleaning fee into a numeric variable
listings$cleaning_fee = as.numeric(gsub("[\\$,]", "", listings$cleaning_fee)) 

# make extra people a numeric variable
listings$extra_people = as.numeric(gsub("[\\$,]", "", listings$extra_people)) 


#Changes NA cleaning fee values to 0, because assuming that 0 is meant for NA
listings <- listings %>%   
  mutate(cleaning_fee = case_when(
    is.na(cleaning_fee) ~ 0, 
    TRUE ~ cleaning_fee
  ))

#create a list of property types and the count
listings%>% 
  group_by(property_type)%>%
  summarise(count= n())%>%
  arrange(desc(count))

#Taking top 4 property_type and creating a new column and assigning property_type in groups
listings <- listings %>%
  mutate(prop_type_simplified = case_when(
    property_type %in% c("Apartment","Condominium", "House","Townhouse") ~ property_type, 
    TRUE ~ "Other"
  ))

#check if all the variables are in the correct type
skim(listings) 

```
```{r filtering, echo=FALSE}

#displaying table with the count in descending order for the minimum nights
listings%>%     
  group_by(minimum_nights)%>%
  summarise(count= n())%>%
  arrange(desc(count))

#Filtering the airbnb data so that it only includes observations less than or equal to 4
listings<-listings%>%
  filter(minimum_nights <= 4)

```
> The most common values are 2,3,1,4,5.That means renting for a five days or less.
We see that there is a dramatic decrease of the number of listing from 5 days and above and this may be due to the fact that people staying for lomger periods are not here for travel purposes but for other reasons such as work, living etc.


```{r echo=FALSE}
listings %>%
  count(property_type, prop_type_simplified) %>%
  arrange(desc(n)) 
```



```{r, echo=FALSE}
library(corrplot)

leaflet(data = filter(listings, minimum_nights <= 4)) %>% 
  addProviderTiles("OpenStreetMap.Mapnik") %>% 
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude, 
                   radius = 1, 
                   fillColor = "blue", 
                   fillOpacity = 0.4, 
                   popup = ~listing_url,
                   label = ~property_type
                    )

eda.cor= cor(listings_numeric)

corrplot(cor(listings_numeric))

eda.cor

```
# REGRESSION

```{r, echo=FALSE}

listings_numeric<- listings %>%
  select(price, accommodates, beds, guests_included, review_scores_rating, number_of_reviews,  bedrooms,  bathrooms,  cleaning_fee) 

listings_categorical<- listings %>%
  select(price, neighbourhood_cleansed, room_type,  room_type,  property_type,  host_is_superhost)





```